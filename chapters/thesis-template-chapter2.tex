 \chapter{Разработка моделей и алгоритмов \dots}

В этой главе описываются разработанные/модифицированные модели/методы/
алгоритмы, или/и описывается применение известных стандартных методов. Также, 
в конце главы обычно приводится общая архитектура программной системы, 
вытекающая из описанной теории. Приведенные ниже заголовки подразделов так же 
весьма примерные и сильно зависят от особенностей конкретной работы.
\section{Формальная постановка задачи геолокации по серии изображений}

Задача геолокации (визуальной локализации) в данном исследовании ставится как задача классификации изображений местности в соответствующие им области земной поверхности. Более формально, пусть:

\begin{compactitem}
	\item $K$ --- число ячеек в которых могли быть сделаны фотографии,
	\item $N$ --- число фотографий,
	\item $m_i$ --- число фотографий в $i$-том альбоме,
	\item $ Q $ --- число альбомов,
	\item $X$ --- множество фотографий. 
	\item $ Y $ --- множество ячеек, 
\end{compactitem}
ячейка --- область земной поверхности, выделенная например с помощью S2 разбиения,\\
фотография --- тензор\, $ l \times q \times 3$  действительных чисел, $ l, q $ --- ширина 
и высота соответственно\footnote{индексы фотографии для простоты опущены},\\
альбом --- список из $ m_i $ фотографий

Даны пары <<фотография --- координаты>>, $ (X_j, y_j) $, возможно объединённые в альбомы по $ m_j $ штук.

Требуется разработать:
\begin{compactitem}

\item обучаемый алгоритм, $ \mathcal{F}: X,W_1 \to Y $
который будет сопоставлять элементу $ x_j $ класс $ \hat{y}_j $ наиболее близкий к тому которым $ x_j $ обладает в реальности,
\item обучаемый алгоритм $ \mathcal{G}: [X],W_2 \to Y $, где $ [x] $ --- список $ x $, решающий эту задачу для альбома.
\end{compactitem}

Обучение $ \mathcal{F} $ и $ \mathcal{G} $ состоит в подборе наборов параметров $ W_1 $ и $ W_2 $. Следует отметить что целесообразно использовать для реализации $ \mathcal{G} $ параметры $ \mathcal{F} $, а значит $ W_2 $ --- суть $ W_1 $ и параметры, специфичные для обработки последовательностей.

Следует также отметить что частота разбиения поверхности может быть различной, а значит для каждого масштаба возможно обучать различные версии $ \mathcal{F}  $ и $ \mathcal{G} $.

Для простоты будем считать что перед подачей на вход алгоритмам изображения масштабируются и обрезаются если требуется. Процесс масштабирования будет описан ниже.

\section{Выбор/разработка методов оценки точности работы алгоритмов геолокации}

Для получения нижней оценки на точность алгоритма можно рассматривать в качестве ошибки предсказания расстояние от центра ячейки $ \hat{y} $ до реальных GPS координат фотографии $ y $, рассчитанное по поверхности земли $ d(a,b) $.

Тогда ошибкой для выборки будет
$$ E = \frac{1}{K} \sum_{i=1}^{K} {d(y_{j},\hat{y_j})}$$

Для обучения будем использовать скользящий контроль.

%TODO go on . . .

\section{Модификация существующих решений в области для работы с серией изображений}

Хотя разрабатываемая архитектура способна локализовать большое разнообразие изображений, многие изображения неоднозначны или не предоставляют достаточно информации, которая позволила бы их локализовать.
Однако мы можем использовать тот факт, что фотографии естественным образом происходят в последовательности, например, альбомы, место съёмки которых часто значительно скоррелировано. Интуитивно, если мы с уверенностью можем локализовать
некоторые из фотографий в альбоме, мы можем использовать эту информацию,
чтобы локализовать фотографии с неопределенным местоположением. Фотографии в альбоме --- это последовательность,
которая требует модели, которая запоминает состояние предыдущего примера, 
при рассмотрении текущего примера. Поэтому целесообразно использовать
(LSTM) \cite{hochreiter1997long} для этой задачи.
Теперь мы рассмотрим, как решить проблему прогнозирования
геолокации последовательности фотографий с использованием LSTM.

\subsection{Архитектура Модели}
Основная структура нашей модели такова:
учитывая изображение, мы извлекаем вектор признаков изображения (до слоя SoftMax) в PlaNet. Этот вектор подается в блок LSTM. Выходной вектор LSTM затем подаётся в слой SoftMax, который
выполняет классификацию в ячейки S2. Мы подаём альбом в модель в хронологическом порядке. В генерации признаков мы переиспользуем параметры модели для одиночного изображения. Во время обучения мы сохраняем их фиксированными и только обучать параметры LSTM и слой SoftMax.


Проблема с этой простой моделью LSTM заключается в том, что многие
альбомы содержат вначале несколько изображений, которые
не содержат полезной визуальной информации. Благодаря своей однонаправленности эта модель не может исправить неверные прогнозы, что
происходят в начале последовательности после наблюдения
фото с уверенным местоположением. По этой причине мы сейчас
оценить модель, в которой LSTM использует множество фотографий
от альбома, прежде чем сделать свое первое предсказание.
Смещение метки. Идея этой модели состоит в том, чтобы сдвинуть поиск поисков, что вывод отложен на несколько временных шагов. Основная мотивация этой идеи состоит в том, что
модель может накапливать информацию из нескольких изображений в
последовательность перед предсказаниями. Тем не менее, мы
обнаружили, что использование смещений не улучшает локализацию
(Таблица 4, LSTM off1, LSTM off2). Предположим, что
из-за ввода входного изображения на выходные метки
становится более сложным, затрудняя прогнозирование
для всех фотографий, улучшая прогнозы только для конечности
количество фотографий. Более того, этот подход не
решить проблему повсеместно: например, если мы компенсируем
метка на 2 шага, но первое изображение
Фертильность возникает только после 3 шагов, прогноз для первого
изображение, вероятно, все еще будет неправильным. Чтобы исправить это, теперь мы сидером, которые определяют их прогнозы на всех изображениях
в последовательности, а не только предыдущие. Повторяющиеся последовательности. Сначала мы оцениваем модель, которая
обученный по последовательностям
включая два экземпляра одной и той же последовательности. для эта модель, мы принимаем только прогнозы для изображений из вторая половина последовательности (т. е. повторяющаяся часть).


При времени вывода, передавая последовательность в модель
в первый раз можно рассматривать как стадию кодирования, где
LSTM создает внутреннее состояние на основе изображений.
Второй проход представляет собой этап декодирования, где на каждом изображении,
LSTM делает прогноз на основе его состояния,
аренда изображение. Результаты показывают, что этот подход превосходит
однопроходные LSTM, достигающие 7,8\%
относительное улучшение на уровне улицы, ценой двоякого
увеличение времени вывода. Однако,
В результате мы обнаружили проблему с этим подходом:
если в начале
последовательности, они, как правило, привязаны к последнему
катиона в последовательности, поскольку модель учится полагаться на
его предыдущее предсказание. Поэтому прогнозы с конца
последовательности переносятся в начало.
Двунаправленный LSTM. Известная нейронная сеть ar-
архитектуры, которая обусловливает прогнозы в целом
последовательности являются двунаправленными LSTM (BLSTM). Эта модель можно рассматривать как конкатенацию двух моделей LSTM mod-
els, где первый выполняет передний проход, а второй выполняет обратный проход по последовательности. двунаправленные LSTM не могут быть обучены с усеченными во времени и, следовательно, для LSTM до полной длины последовательности. Чтобы уменьшить
вычислительную стоимость обучения, нам пришлось ограничить продолжительность
последовательности до 25 изображений. Это приводит к снижению общего
точность, поскольку более длинные альбомы обычно дают
более короткими. Поскольку наши эксперименты по этим данным
не сопоставимы с предыдущими, мы также
оценить повторяющуюся модель LSTM на усеченных последовательностях
до 25 изображений. Как показывают результаты BLSTM явно превосходят повторные LSTM
(Относительное улучшение на уровне улицы на 16,6\%). Однако,
потому что они не подходят для длинных последовательностей, повторяющиеся модель может быть предпочтительнее на практике.


\section{Разработка метода геолокации по серии изображений используя выбранные/разработанные выше алгоритмы/методы}

В ряде случаев, все или некоторые результаты проектирования могут быть представлены во второй главе. Обычно же архитектура описывается в третьей главе.

\section{Выводы}

Необходимо перечислить, какие теоретические результаты были получены с 
указанием степени новизны. Например: <<Была разработана такая-то модель. Она 
представляет собой адаптированную версию модели $X$, в которой уравнение $Z$ 
заменено на уравнение $Z'$>>. Еще пример: <<Была предложена такая-то 
архитектура, она отличается от типовой в том-то и том-то. Это позволяет 
избежать таких-то проблем.>>. При этом не следует заниматься <<высасыванием из 
пальца>>: <<Поставленная задача является типовой; для ее решения применены 
стандартные средства (перечислить, какие).>>.
